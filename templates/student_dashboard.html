{% extends "base.html" %}

{% block content %}
<h1 class="text-2xl font-semibold mb-4">Student Dashboard ðŸŽ“</h1>

<div class="bg-white ring-1 ring-slate-200 rounded-lg p-4 mb-6">
  <div class="flex flex-wrap items-center justify-between gap-3">
    <div>
      <h2 class="text-lg font-medium">Welcome, {{ name }}</h2>
      <p class="text-sm text-slate-500">Student ID: {{ session.user_id }}</p>
    </div>
    <div class="text-right">
      <span class="inline-flex items-center rounded-full bg-indigo-50 text-indigo-700 px-3 py-1 text-sm font-medium">Total Credits: {{ total_credits }}</span>
    </div>
  </div>
</div>

<hr>

<h2 class="text-xl font-semibold">ðŸ“š My Registrations</h2>
{% if registered_courses %}
    <div class="overflow-x-auto mt-3">
    <table class="min-w-full bg-white ring-1 ring-slate-200 rounded-lg overflow-hidden">
        <thead class="bg-slate-50">
          <tr>
            <th class="px-4 py-2 text-left text-sm font-semibold text-slate-700">Course Title</th>
            <th class="px-4 py-2 text-left text-sm font-semibold text-slate-700">Credits</th>
            <th class="px-4 py-2 text-left text-sm font-semibold text-slate-700">Semester</th>
            <th class="px-4 py-2 text-left text-sm font-semibold text-slate-700">Grade</th>
            <th class="px-4 py-2 text-left text-sm font-semibold text-slate-700">Status</th>
            <th class="px-4 py-2 text-left text-sm font-semibold text-slate-700">Action</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100">
        {% for course in registered_courses %}
        <tr>
            <td class="px-4 py-2">{{ course.title }}</td>
            <td class="px-4 py-2">{{ course.credits }}</td>
            <td class="px-4 py-2">{{ course.semester_name }}</td>
            <td class="px-4 py-2">{{ course.grade if course.grade else 'In Progress' }}</td>
            <td class="px-4 py-2">{% if course.grade %}<span class="inline-flex rounded-full bg-emerald-50 text-emerald-700 px-2 py-0.5 text-xs font-medium">Completed</span>{% else %}<span class="inline-flex rounded-full bg-amber-50 text-amber-700 px-2 py-0.5 text-xs font-medium">Active</span>{% endif %}</td>
            <td class="px-4 py-2">
                {% if not course.grade %}
                <form method="POST" action="{{ url_for('deregister', reg_id=course.reg_id) }}">
                    <button type="submit" class="px-3 py-1.5 rounded-md bg-rose-600 text-white hover:bg-rose-700 transition">Drop</button>
                </form>
                {% else %}<span class="text-slate-400">-</span>{% endif %}
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    </div>
{% else %}
    <p>You have not registered for any courses yet. Start with the section below!</p>
{% endif %}

<hr>

<h2 class="text-xl font-semibold">âž• Available Offerings</h2>
<p class="text-sm text-slate-600">Use Register to enroll. Capacity and time-conflict triggers enforce constraints; prerequisites are checked first.</p>
{% if available_courses %}
    <div class="overflow-x-auto mt-3">
    <table class="min-w-full bg-white ring-1 ring-slate-200 rounded-lg overflow-hidden">
        <thead class="bg-slate-50">
          <tr>
            <th class="px-4 py-2 text-left text-sm font-semibold text-slate-700">Course ID</th>
            <th class="px-4 py-2 text-left text-sm font-semibold text-slate-700">Title</th>
            <th class="px-4 py-2 text-left text-sm font-semibold text-slate-700">Credits</th>
            <th class="px-4 py-2 text-left text-sm font-semibold text-slate-700">Faculty-in-Charge</th>
            <th class="px-4 py-2 text-left text-sm font-semibold text-slate-700">Semester</th>
            <th class="px-4 py-2 text-left text-sm font-semibold text-slate-700">Section</th>
            <th class="px-4 py-2 text-left text-sm font-semibold text-slate-700">Enrollment</th>
            <th class="px-4 py-2 text-left text-sm font-semibold text-slate-700">Prerequisites</th>
            <th class="px-4 py-2 text-left text-sm font-semibold text-slate-700">Action</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100">
        {% for course in available_courses %}
        <tr>
            <td class="px-4 py-2">{{ course.course_id }}</td>
            <td class="px-4 py-2">{{ course.title }}</td>
            <td class="px-4 py-2">{{ course.credits }}</td>
            <td class="px-4 py-2">{{ course.faculty_name }}</td>
            <td class="px-4 py-2"><span class="inline-flex rounded-full bg-sky-50 text-sky-700 px-2 py-0.5 text-xs font-medium">{{ course.semester_name }}</span></td>
            <td class="px-4 py-2">{{ course.section }}</td>
            <td class="px-4 py-2">
                {% if course.seats_remaining is not none %}
                    {{ course.current_enrollment }}/{{ course.max_capacity }} <span class="text-slate-400">({{ course.seats_remaining }} left)</span>
                {% else %}
                    -
                {% endif %}
            </td>
            <td class="px-4 py-2">
                {% if course.prereq_ok %}
                    <span class="inline-flex rounded-full bg-emerald-50 text-emerald-700 px-2 py-0.5 text-xs font-medium">OK</span>
                {% else %}
                    <span class="inline-flex rounded-full bg-rose-50 text-rose-700 px-2 py-0.5 text-xs font-medium">Not satisfied</span>
                {% endif %}
            </td>
            <td class="px-4 py-2">
                <form method="POST" action="{{ url_for('register_course', course_id=course.course_id) }}">
                    {% set disabled = (not course.prereq_ok) or (course.seats_remaining is defined and course.seats_remaining is not none and course.seats_remaining <= 0) %}
                    <button type="submit" class="px-3 py-1.5 rounded-md text-white transition {{ 'bg-slate-400 cursor-not-allowed' if disabled else 'bg-indigo-600 hover:bg-indigo-700' }}" {% if disabled %}disabled{% endif %}>Register</button>
                </form>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    </div>
{% else %}
    <p>No new courses are currently available for registration.</p>
{% endif %}

{% endblock %}